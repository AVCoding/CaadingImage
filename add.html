<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
  
  </head>
  <body>

    
    <img id="SourceImage" src="https://previews.123rf.com/images/lightfieldstudios/lightfieldstudios2002/lightfieldstudios200211714/140553324-stacked-cardboard-boxes-with-barcodes-and-qr-codes-on-cards.jpg" crossorigin="Anonymous">
    <canvas id="Canvas"></canvas>
    <button id="filterButton">Wasm</button>
    
    <button id="withoutButton">Without</button>
    
    <script type='text/javascript'> 
        var withoutButton = document.getElementById('withoutButton');
      
      
      
  withoutButton.addEventListener('click', function () {
    
        let canvas;
        let context;
        let image = document.getElementById('SourceImage');
        canvas = document.getElementById('Canvas');
        context = canvas.getContext('2d');
        canvas.width = image.width;
        canvas.height = image.height;
        context.drawImage(image, 0, 0);
        let imageData;

    
     imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      console.time('Function #2');

        for (let i = 0; i < imageData.data.length; i += 4) {
          let r = imageData.data[i];
          let g = imageData.data[i+1];
          let b = imageData.data[i+2];
          let a = imageData.data[i+3];
          imageData.data[i] = r;
          imageData.data[i+1] = r;
          imageData.data[i+2] = r;
          imageData.data[i+3] = a;
        }

     context.putImageData(imageData, 0, 0);
     console.timeEnd('Function #2')
       
  });
      
    </script>

    <script type='text/javascript'>
  
      
      
      
      
      var statusElement = document.getElementById('status');
      var progressElement = document.getElementById('progress');
      var spinnerElement = document.getElementById('spinner');

       var Module = {
        preRun: [],
        postRun: [myFunction]
        };
    
      
      
   
    
    function myFunction(){
      
        var canvas;
        var context;
        var image = document.getElementById('SourceImage');
        canvas = document.getElementById('Canvas');
        context = canvas.getContext('2d');
        canvas.width = image.width;
        canvas.height = image.height;
        context.drawImage(image, 0, 0);
        var imageData;

      
        imageData = context.getImageData(0, 0, canvas.width, canvas.height);
        
        const myArray = new Uint8Array(imageData.data);

        const buffer = _malloc(myArray.length);
        Module.HEAPU8.set(myArray, buffer);

        console.time('Function #1');
        ccall('grayScale', null, ['number', 'number'], [buffer, myArray.length]);
        console.timeEnd('Function #1')
        // console.log(Module.HEAPU8.subarray(buffer, buffer+myArray.length));
      
        var res = Module.HEAPU8.subarray(buffer, buffer+myArray.length);
        imageData.data.set(res);
        context.putImageData(imageData, 0, 0);
        _free(buffer);
     

     }


//     var Module = {
//        onRuntimeInitialized: function() {
         
//          var filterButton = document.getElementById('filterButton');
//          filterButton.addEventListener('click', function () {
//              myFunction();
//          });
         
         
//         }
//     };
    
      
    </script>
    
    

    
    <script async type="text/javascript" src="add.js"></script>
  </body>
</html>


